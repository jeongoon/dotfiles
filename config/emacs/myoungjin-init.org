#+TITLE: Emacs Configuration
#+STARTUP: content nohideblocks noalign
#+PROPERTY: header-args :comment yes

* Server Detection
#+BEGIN_SRC emacs-lisp
  (defvar my/server-type
    (or (bound-and-true-p my/loading-server-type) 'universal))
  
  (message "Using server type: %s" my/server-type)

#+END_SRC

* Repos
#+BEGIN_SRC emacs-lisp
;;(add-to-list 'package-archives '("melpa" . "https://melpa.org/packages/"))
;; this should be inside init.el
#+END_SRC

* Straight.el - package directly from git repo
  :LOGBOOK:
   use every package from straight?
   global ensure mode on use-package vs type everty time :ensure t
  :End:
  - I used this package for eyeliner(a modline generator) for the first time
  - this is quite useful when you are using pacakge directly from git repo which is not on elpa yet
#+BEGIN_SRC emacs-lisp
  (defvar bootstrap-version)
  (let ((bootstrap-file
         (expand-file-name "straight/repos/straight.el/bootstrap.el" user-emacs-directory))
        (bootstrap-version 5))
    (unless (file-exists-p bootstrap-file)
      (with-current-buffer
          (url-retrieve-synchronously
           "https://raw.githubusercontent.com/raxod502/straight.el/develop/install.el"
           'silent 'inhibit-cookies)
        (goto-char (point-max))
        (eval-print-last-sexp)))
    (load bootstrap-file nil 'nomessage))
  (require 'straight)
#+END_SRC

* MyJin Package | Library | Functions
#+BEGIN_SRC emacs-lisp
  (org-babel-do-load-languages
   'org-babel-load-languages
  '((shell . t)))

  (defun myjin/display-graphic-p ()
    "Alternative display-graphic-p for daemon modes"
    (or (eq my/server-type 'gui-server)
        (and (eq my/server-type 'universal)
             (not (daemonp)))))

  (defun myjin/org-agenda ()
    "Update agenda file list first and go org-agenda"
    (myjin/update-org-agenda-files-list)
    (org-agenda))

  (defun myjin/hungry-delete-backward ()
    "Work around for hungry-delete-backward"
    (interactive)
    (hungry-delete-backward 1)
    )

  (defun myjin/hungry-delete-forward ()
    "Work around for hungry-delete-forward"
    (interactive)
    (hungry-delete-forward 1)
    )

  (defun myjin/org-insert-todo-heading ()
    "Work around for org-insert-todo-heading"
    (interactive)
    (org-insert-todo-heading t)) ;; IDK :( what ARG means

  (defun myjin/load-file (a-file-name &optional prefix-or-t)
    "Load File A-FILE-NAME.
      use `user-emacs-directory' if PREFIX-OR-T is t.
      or prepend prefix."
    (interactive)
    (setq a-file-path (myjin/expand-file-name a-file-name prefix-or-t))
    (unless (find-file a-file-path)
      (message "myjin/load-file: %s failed: full-path was: %s"
               a-file-name a-file-path)))

  (defun myjin/expand-file-name (file-name
                                 &optional prefix)
    "Expand FILE-NAME by default, prepend user-emacs-dir if prefix is 't, prepend `PREFIX' if given."
    (if (eq prefix 't)
        (setq file-name (concat user-emacs-directory
                                (convert-standard-filename file-name)))
      (unless (eq prefix 'nil)
        (setq file-name (expand-file-name file-name prefix))))
    (setq file-name (expand-file-name file-name)))

  (defun myjin/revert-buffer-without-confirm ()
    "Reverting buffer without annoying confirmation everytime."
    (interactive)
    (let ((ignore-buffer nil) (no-confirm t))
      (revert-buffer ignore-buffer no-confirm)
        (message "myjin/revert-buffer-without-confirm: Buffer reverted.")))

  (defun myjin/create-fontset (fontset-family-ascii fontset-name fontset-size)
    "Create a fontset from fontspec.
      use FONTSET-FAMILY-DEFAULT as default family name.
      You can refer the set as FONTSET-NAME."
    ;; FIXME: 16/Feb/2022 use-package
    (require 's)
    (if (member fontset-family-ascii (font-family-list))
        (progn
          (when (s-match "[-[:blank:]]+" fontset-name)
            (user-error (concat "%s contains blank or a dash(`-')"
                                "which is not allowed for fontset name")
                        fontset-name))
          (let (fsl fspec-str)
              (setq fsl (split-string (car (x-list-fonts
                                            fontset-family-ascii t nil 1)) "-"))
              (setf (nth 3 fsl) "*" (nth 4 fsl) "*" (nth 5 fsl) "*"
                    ;; note: 13th elemets must be "fontset"
                    (nth 13 fsl) "fontset" (nth 14 fsl) fontset-name)
              (setq fspec-str (string-join fsl "-"))
              (create-fontset-from-fontset-spec fspec-str)
              (set-fontset-font (concat "fontset" "-" fontset-name) 'ascii
                                (font-spec :family fontset-family-ascii
                                           :size fontset-size :height 1.0))))
        (user-error "%s is not found in (font-family-list)" fontset-family-ascii)))

    ;; 2nd Feb from http://xahlee.info/emacs/emacs/emacs_dired_open_file_in_ext_apps.html
    (defun xah/open-in-external-app (&optional Fname)
      "Open the current file or dired marked files in external app.
    When called in emacs lisp, if Fname is given, open that.

    URL `http://xahlee.info/emacs/emacs/emacs_dired_open_file_in_ext_apps.html'
    Version: 2019-11-04 2023-04-05 2023-06-26"
      (interactive)
      (let (xfileList xdoIt)
        (setq xfileList
              (if Fname
                  (list Fname)
                (if (eq major-mode 'dired-mode)
                    (dired-get-marked-files)
                  (list buffer-file-name))))
        (setq xdoIt (if (<= (length xfileList) 10) t
                      (y-or-n-p "Open more than 10 files? ")))
        (when xdoIt
          (cond
           ((eq system-type 'windows-nt)
            (let ((xoutBuf (get-buffer-create "*xah open in external app*"))
                  (xcmdlist
                   (list "PowerShell" "-Command" "Invoke-Item" "-LiteralPath")))
              (mapc
               (lambda (x)
                 (message "%s" x)
                 (apply 'start-process
                        (append (list "xah open in external app" xoutBuf)
                                xcmdlist
                                (list
                                 (format "'%s'" (if (string-match "'" x)
                                                    (replace-match "`'" t t x) x)))
                                nil)))
               xfileList)
              ;; (switch-to-buffer-other-window xoutBuf)
              )
            ;; old code. calling shell. also have a bug if filename contain apostrophe
            ;; (mapc (lambda (xfpath) (shell-command (concat "PowerShell -Command \"Invoke-Item -LiteralPath\" " "'" (shell-quote-argument (expand-file-name xfpath)) "'"))) xfileList)
            )
           ((eq system-type 'darwin)
            (mapc
             (lambda (xfpath)
               (shell-command
                (concat "open " (shell-quote-argument xfpath)))) xfileList))
           ((eq system-type 'gnu/linux)
            (mapc (lambda (xfpath)
                    (call-process shell-file-name nil 0 nil
                                  shell-command-switch
                                  (format "%s %s"
                                          "xdg-open"
                                          (shell-quote-argument xfpath))))
                  xfileList))
           ((eq system-type 'berkeley-unix)
            (mapc
             (lambda (xfpath)
               (let ((process-connection-type nil))
                 (start-process "" nil "xdg-open" xfpath))) xfileList))))))

  (defun myjin/insert-left-quote ()
    "Insert left curly quote"
    (interactive)
    (insert "‚Äò"))

  (defun myjin/insert-right-quote ()
    "Insert right curly quote"
    (interactive)
    (insert "‚Äô"))
#+END_SRC

***  TODO better argument handling with `:tag value' sequene


* Global Settings | Custom Values
#+BEGIN_SRC emacs-lisp
  (require 'bind-key)

  (column-number-mode 1)
  (global-font-lock-mode 1)
  (global-hl-line-mode 1)

  (defcustom work-mode-modeline-preference 'powerline
    "What is your favourite modeilne ('powerline 'powerline+airline
  'doom-modeline 'spaceline 'spaceline+all-the-icons 'spaceline+eyeliner)"

    :type '(choice
            (const :tag "default" powerline) ;; STUDY what is the meaning of :tag??
            (const powerline+airline)
            (const doom-modeline)
            (const spaceline)
            (const spaceline+all-the-icons)
            (const spaceline+eyeliner))
    :group 'work-mode)

  (defcustom work-mode-powerline+airline-theme 'airline-gruvbox-dark
    "what is your airline theme to use?"
    :type 'string
    :group 'work-mode)

  (defcustom work-mode-modeline-fallback 'doom-modeline
    "What is your fallback when your preffered modeline is not going to work"
    :type 'string
    :group 'work-mode)
#+END_SRC
** Diminish / Minor-mode Display 
    :LOGBOOK:
    - Note taken on [2020-05-31 Sun 23:33] \\
      I guess this part should come first work properly
      Because I put this one after which-key package and realized that
      WK (lighter for Which-key) is shown.
    - Note taken on [2020-05-16 Sat 16:35] \\
      use dolist for diminishing some modes
    :END:
   * if you are using spaceline with eyeliner, you don't really need to use diminish
 #+BEGIN_SRC emacs-lisp
     (require 'diminish)
     (let (package-string mode-string)
       (dolist (package-symbol '(auto-revert
                                 beacon which-key
                                 ivy hs-minor whitespace
                                 highlight-parentheses
                                 undo-tree
                                 highlight-indent-guides
                                 projectile projectile-rails
                                 flycheck))
         (setq package-string (symbol-name package-symbol))
         (setq mode-string (concat package-string "-mode"))

   ;; XXX: not working
   ;;      `(eval-after-load ,package-symbol
   ;;        (lambda () (diminish (quote ,mode-string))) "")
     ;; WORKAROUND
         (add-hook (intern (concat mode-string "-hook"))
                   `(lambda () (diminish (intern ,mode-string))))
         ))
   ;; use alternative names ...

   (add-hook 'paredit-mode-hook
             (lambda () (diminish 'paredit-mode
                             (if (myjin/display-graphic-p) " ‚∏®‚úì" " ‚∏®PE"))))

   (add-hook 'all-the-icons-dired-mode-hook
             (lambda () (diminish 'all-the-icons-dired-mode
                             (if (myjin/display-graphic-p) " üìÅ" " iDired"))))

   ;; but this one works with `eval-after-load'
   ;; need to check how use-package deal with this.
   ;;  (eval-after-load 'highlight-indent-guides
   ;;    (lambda () (diminish 'highlight-indent-guides-mode (if (display-graphic-p ) " ‚õô" "|{"))))
   ;;
   (setq eldoc-minor-mode-string (if (myjin/display-graphic-p) " üìö" " Ed"))

 #+END_SRC
*** TODO  make a type list for diminishing.
    - 1. eval-after-load, 2. add-hook, a. change the name

** Parenthesis
#+BEGIN_SRC emacs-lisp
(show-paren-mode 1)
(setq show-paren-style 'parenthesis) ; or expression
(setq show-paren-delay 0)

(use-package highlight-parentheses :ensure t)
(use-package rainbow-delimiters
  :ensure t
  :config
  (add-hook 'lisp-mode-hook
            (lambda()
              (rainbow-delimiters-mode))))

(global-highlight-parentheses-mode)
#+END_SRC

** ParEdit
   :LOGBOOK:
   - Note taken on [2020-05-31 Sun 14:20] \\
     shortcuts are moved to shortcuts
   :END:
#+BEGIN_SRC emacs-lisp
  (use-package paredit :ensure t)
#+END_SRC

** Which-key
#+BEGIN_SRC emacs-lisp
(use-package which-key
  :ensure t
  :config
  (which-key-mode 1))
#+END_SRC

** Tabbar
#+BEGIN_SRC emacs-lisp
(use-package tabbar
  :ensure t
  :config (progn
            (tabbar-mode 1)))
#+END_SRC

** Miscellaneous
 #+BEGIN_SRC emacs-lisp
 (setq-default major-mode 'text-mode)
 (setq-default indent-tabs-mode nil) ; I prefer not to use indent-tabs-mode

 (transient-mark-mode 1)

 (require 'whitespace)
 (setq whitespace-style '(face empty tabs lines-tail trailing))
 #+END_SRC
* Font 
** All-the-icons
#+BEGIN_SRC emacs-lisp
   (use-package all-the-icons :ensure t :straight t)
#+END_SRC
** Unicode site
    [[https://unicode-table.com/]]
    ‚ë†‚ë°‚ë¢‚ë£‚ë§‚ë¶‚ëß‚ë®
** ‚òï : how to inform the user to install fonts via

    =M-x all-the-icons-install-fonts= ???
* Apperance / Window
** Frame Setup (frame, default font)
#+BEGIN_SRC emacs-lisp
    (defvar myjin/korean-font-family "KoPub Batang"
      "Default Korean font for my setting")

    (setq inhibit-startup-message t)

    ;; GUI ÌîÑÎ†àÏûÑ ÏÑ§Ï†ï Ìï®Ïàò
    (defun myjin/configure-gui-frame (frame)
      "Configure GUI frame"
      (when (display-graphic-p frame)
        (with-selected-frame frame
          ;; Ìà¥Î∞î/Ïä§ÌÅ¨Î°§Î∞î Ï†úÍ±∞
          (when (fboundp 'scroll-bar-mode)
            (scroll-bar-mode -1))
          (when (fboundp 'tool-bar-mode)
            (tool-bar-mode -1))

          ;; Í∏∞Î≥∏ Ìè∞Ìä∏ ÏÑ§Ï†ï
          (when (member "FantasqueSansMono Nerd Font Mono" (font-family-list))
            (set-frame-font "FantasqueSansMono Nerd Font Mono-11" nil t))

          ;; ÌïúÍ∏Ä Ìè∞Ìä∏ ÏÑ§Ï†ï
          (when (member myjin/korean-font-family (font-family-list))
            (set-fontset-font t 'hangul (font-spec :family myjin/korean-font-family))
            ;; Ïú†ÎãàÏΩîÎìú Î≤îÏúÑÎ°úÎèÑ ÏÑ§Ï†ï (Î≥¥ÌóòÏö©)
            ;;(set-fontset-font t '(#xac00 . #xd7af) myjin/korean-font-family)
            )

          ;; Í∏∞ÌÉÄ Ïú†ÎãàÏΩîÎìú Ìè∞Ìä∏Îì§
          (dolist (fmname '("Symbola" "Noto Color Emoji" "FreeSerif"))
            (when (member fmname (font-family-list))
              (set-fontset-font t 'unicode (font-spec :family fmname) nil 'append)))

          ;; ÌîÑÎ†àÏûÑ ÌÅ¨Í∏∞ÏôÄ ÏúÑÏπò
          (when (or (eq my/server-type 'gui-server)
                    (and (eq my/server-type 'universal)
                         (not (daemonp))))
            (set-frame-parameter frame 'width 100)
            (set-frame-parameter frame 'height 
                                (if (< (display-pixel-height) 698) 30 70))
            (set-frame-parameter frame 'left 1000)
            (set-frame-parameter frame 'top 1)))))

    ;; face-font-rescale-alist ÏÑ§Ï†ï
    (setq face-font-rescale-alist 
          `(("Material Icons" . 0.8)
            ("FontAwesome" . 0.8)
            ("github-octicons" . 0.8)
            ("all-the-icons" . 0.8)
            ("file-icons" . 0.85)
            (,myjin/korean-font-family . 1.15)))
    ;; ÌÖåÎßà Î°úÎî©
    (use-package leuven-theme
      :ensure t
      :config
      (load-theme 'leuven t))
    ;; ÎùºÏù¥Î∏åÎü¨Î¶¨ Í≤ΩÎ°ú
    (add-to-list 'load-path (concat user-emacs-directory
                                    (convert-standard-filename "our-lisp/")))
    ;; Îç∞Î™¨ Î™®ÎìúÏóêÏÑú ÌîÑÎ†àÏûÑ ÏÑ§Ï†ï
    (if (daemonp)
        (add-hook 'after-make-frame-functions #'myjin/configure-gui-frame)
      ;; ÏùºÎ∞ò Î™®ÎìúÏóêÏÑú ÏÑ§Ï†ï
      (when (display-graphic-p)
        (myjin/configure-gui-frame (selected-frame))))
#+END_SRC

*** ‚úñ find the better way to move window right hand side (better calcuation based on window size)
CLOSED: [2022-02-17 Thu 22:16]
*** ‚òï still Atom appears bigger among the files in all-the-icons-dired mode
** Modeline: Powerline vs Doom-modeline vs Spaceline
    :LOGBOOK:
    - Note taken on [2020-05-31 Sun 16:38] \\
      [2020-05-14 Thu] spaceline not working on terminal -> going back to fallback modeline
      [2020-05-24 Sun] Use defcustom for powerline theme (default, airline:(with theme name))
    :END:

*** Desc / Code
    * mode-line, modeline (for search)
    * Powerline is fancy Doom-modeline looks clean but needs some fonts installed

#+BEGIN_SRC emacs-lisp
  (defvar work-mode-airline-theme-fallback 'airline-gruvbox-dark)

  (let ((setting-modeline? t) (curr-ml work-mode-modeline-preference)
        (fallback-ml work-mode-modeline-fallback) (max-try 10))
    (while (and setting-modeline? (> max-try 0))
      (setq max-try (1- max-try))
      (catch 'modeline-switch
        (cond
         ((eq curr-ml 'powerline)
          (use-package powerline :ensure t :straight t
            :config (powerline-default-theme))
          (setq setting-modeline? nil))

         ((eq curr-ml 'powerline+airline)
          (require 's)
          (use-package airline-themes
            :ensure t
            :config
            (progn
              (let (atheme uts) ;; uts: u ser t heme s ymbol
                (setq uts work-mode-powerline+airline-theme) ;; copy
                (if (s-starts-with? "airline-" (symbol-name uts));; FIXME correct?
                    (setq atheme uts) ;; or
                  ((setq atheme work-mode-airline-theme-fallback)
                   (message (concat
                             "[work-mode] please set correct value of %s: "
                             "reverting to %s") uts theme)))
              (load-theme atheme t)
                (setq setting-modeline? nil)))))

         ((eq curr-ml 'doom-modeline)
          (use-package doom-modeline
            :ensure t
            :defer t
            :hook (after-init . doom-modeline-mode))
          (setq setting-modeline? nil))

         ((eq curr-ml 'spaceline)
          (use-package spaceline :ensure t :straight t
            :config (progn (require 'spaceline-config)
                           (spaceline-emacs-theme)))
          (setq setting-modeline? nil))

         ((eq curr-ml 'spaceline+all-the-icons)
          (use-package spaceline-all-the-icons :ensure t :straight t
            :config (progn
                      (require 'spaceline)
                      (spaceline-all-the-icons-theme)))
          (setq setting-modeline? nil))

         ((eq curr-ml 'spaceline+eyeliner)
          (unless (myjin/display-graphic-p)
            (message "your preffered modelines 'spaceline is not working on terminal: going back to: %s" fallback-ml)
            (setq curr-ml fallback-ml)
            (throw 'modeline-switch fallback-ml))

            (use-package eyeliner
              :ensure t
              :straight (eyeliner :type git
                                  :host github
                                  :repo "dustinlacewell/eyeliner")
              :config
              (progn
                ; spaceline + eyeliner will complain without it
                (autoload 'projectile-project-p "projectile")
                (require 'eyeliner)
                (eyeliner/install)))
            (setq setting-modeline? nil))))))
#+END_SRC

*** ‚òï make a seperate function for loading theme: too long lines.

** Not So MiniBuffer
#+BEGIN_SRC emacs-lisp
  (setq resize-mini-windows nil) ;; set `nil' to keep size after resizing minibuffer
                                 ;; and do something else
  (defun resize-minibuffer-window (&optional greeting-message)
    (interactive) ; needed because we will use inside global-set-key as well
    (let* ((minibuffer-orig-height (window-size (minibuffer-window)))
           (minibuffer-new-height 7)
           (delta (- minibuffer-new-height minibuffer-orig-height))
           )
      (if (= 0 delta)
          nil
          (progn
            (window-resize (minibuffer-window) delta)
            (when greeting-message (message "Have a nice one. ;^]"))
            )
          )))

    ;; resize minibuffer on terminal and window-system when initializing
  (add-hook 'window-state-change-hook (lambda ()
                                        (resize-minibuffer-window t)))

  (global-set-key (kbd "C-l") (lambda()
                                (interactive) ; without this emacs will complain
                                (redraw-display)
                                (resize-minibuffer-window)))
#+END_SRC
** Ace-window (window management)
#+BEGIN_SRC emacs-lisp
  ;; copyright: https://github.com/zamansky/using-emacs/blob/master/myinit.org
  (use-package ace-window :ensure t
    :init
    (progn
      (setq aw-scope 'global) ;; was frame
      (global-set-key (kbd "C-x O") 'other-frame)
      (global-set-key [remap other-window] 'ace-window)
      (custom-set-faces
       '(aw-leading-char-face
         ((t (:inherit ace-jump-face-foreground :height 3.0)))))))

#+END_SRC

* Programming, Editing
** Yaml
#+begin_src emacs-lisp
  (use-package yaml-mode :ensure t)
#+end_src

** AucTex
#+begin_src emacs-lisp
  (use-package tex :ensure auctex)
#+end_src

** Saveplace
   automatically save last edit place
#+BEGIN_SRC emacs-lisp
  (require 'saveplace)
  (setq save-place-file "~/.config/emacs/places")
  (setq save-place-forget-unreadable-files nil)
  (save-place-mode 1)
#+END_SRC

** Display line numbers
#+BEGIN_SRC emacs-lisp
(require 'display-line-numbers)
(setq display-line-numbers t)
(setq display-line-numbers-type t) ; setting display-line-numbers isn't enough

(setq display-line-numbers-current-absoulte t)

(defcustom display-line-numbers-allowed-on-starred-buffers 'nil
  "Disable buffers that have stars in them like *Gnu Emacs*"
  :type 'boolean
  :group 'display-line-numbers)

(defun display-line-numbers--turn-on ()
  "turn on line numbers in `display-line-numbers-allowed-modes' but excluding
certain major modes defined in `display-line-numbers-exempt-modes'"
  (if (or display-line-numbers-allowed-on-starred-buffers
          (not string-match "*" (buffer-name)))
      (display-line-numbers-mode 1)
    (display-line-numbers-mode 0)))
#+END_SRC
** More language modes
#+BEGIN_SRC emacs-lisp
  (use-package raku-mode :ensure t :defer t)
  (use-package fish-mode :ensure t :defer t)
  (use-package flycheck-haskell :ensure t :defer t
    :after haskell-mode
    :config
    (add-hook 'haskell-mode-hook #'flycheck-haskell-setup))
  (use-package rust-mode :ensure t)
  (use-package haskell-mode :ensure t)
  (use-package go-mode :ensure t)
  (use-package elm-mode :ensure t :defer t)
  ;;(use-package hamlet-mode :ensure t :defer t)
  (use-package shakespeare-mode
    :ensure t :defer t
    :config
    (add-hook 'shakespeare-mode-book 'rainbow-mode))

  ;; (use-package mmm-mode
  ;;   :config
  ;;   (progn
  ;;     (use-package hamlet-mode :ensure t)
  ;;     (setq mmm-global-mode t)
  ;;     (require 'mmm-auto)
  ;;     (mmm-add-classes
  ;;      '((hamlet-quasiquote
  ;;         :submode hamlet-mode
  ;;         :delimiter-mode nil
  ;;         :front "\\[.*hamlet|"
  ;;         :back "|\\]")))
  ;;     (mmm-add-mode-ext-class 'haskell-mode nil 'hamlet-quasiquote)))
  (use-package clojure-mode :ensure t)
  (use-package cider
    :ensure t
    :config
    ;; 23 JAN 2024
    ;; from https://www.youtube.com/watch?v=KMWLIgG986I
    (setq cider-repl-result-prefix ";; => "
          cider-eval-result-prefix ""
          ;;cider-connection-message-fn nil
          cider-repl-prompt-function #'myjin/cider-repl-prompt
          ;;cider-use-oeverlays nil ; echo area is fine
          cider-repl-display-help-banner nil
          ))
  (defun myjin/cider-repl-prompt (namespace)
    "Return a prompt string that mentions NAMESPACE."
    (format "%süçÄ " (cider-abbreviate-ns namespace)))
  ;; CSS 16 NOV 2025
  (use-package rainbow-mode
    :ensure t
    :hook ((css-mode . rainbow-mode)
           (scss-mode . rainbow-mode)
           (html-mode . rainbow-mode))
    :config
    (setq rainbow-x-colors nil))  ; X11 Ïª¨Îü¨ Ïù¥Î¶Ñ ÎπÑÌôúÏÑ±Ìôî (ÏÑ†ÌÉùÏÇ¨Ìï≠)
#+END_SRC

#+RESULTS:
| rainbow-mode |

** Flycheck
#+BEGIN_SRC emacs-lisp
(use-package flycheck
  :ensure t
  :defer t
  :init (add-hook 'prog-mode-hook 'flycheck-mode))

;;(use-package flycheck-perl6 :ensure t)
#+END_SRC
** [DISALED] Auto-complete
#+BEGIN_SRC emacs-lisp
;; https://cestlaz.github.io/posts/using-emacs-8-autocomplete/
;;(use-package auto-complete
;;  :ensure t
;;  :init
;;  (progn
;;    (ac-config-default)
;;    (global-auto-complete-mode t) ))

;;(add-to-list 'ac-modes 'raku-mode)


#+END_SRC
** [DISABLED] Swiper / Counsel
   - [[https://cestlaz.github.io/posts/using-emacs-6-swiper/]]
#+BEGIN_SRC emacs-lisp
;;(use-package counsel :ensure t )

;;(use-package swiper
;;  :ensure try
;;  :config
;;  (progn
;;    (ivy-mode 1)
;;    (setq ivy-use-virtual-buffers t)
;;    (setq ivy-height 7)
;;    (setq ivy-fixed-height-minibuffer nil)
;;    (global-set-key "\C-s" 'swiper)
;;    (global-set-key (kbd "C-c C-r") 'ivy-resume)
;;    (global-set-key (kbd "<f6>") 'ivy-resume)
;;    (global-set-key (kbd "M-x") 'counsel-M-x)
;;    (global-set-key (kbd "C-x C-f") 'counsel-find-file)
;;    (global-set-key (kbd "<f1> f") 'counsel-describe-function)
;;    (global-set-key (kbd "<f1> v") 'counsel-describe-variable)
;;    (global-set-key (kbd "<f1> l") 'counsel-load-library)
;;    (global-set-key (kbd "<f2> i") 'counsel-info-lookup-symbol)
;;    (global-set-key (kbd "<f2> u") 'counsel-unicode-char)
;;    (global-set-key (kbd "C-c g") 'counsel-git)
;;    (global-set-key (kbd "C-c j") 'counsel-git-grep)
;;    (global-set-key (kbd "C-c k") 'counsel-ag)
;;    (global-set-key (kbd "C-x l") 'counsel-locate)
;;    (global-set-key (kbd "C-S-o") 'counsel-rhythmbox)
;;    (define-key read-expression-map (kbd "C-r") 'counsel-expression-history)
;;    ))
#+END_SRC

* Vertico + Consult + Orderless
#+BEGIN_SRC emacs-lisp
  ;; 1. ÎØ∏ÎãàÎ≤ÑÌçº ÏôÑÏÑ± ÌîÑÎ†àÏûÑÏõåÌÅ¨
  (use-package vertico
    :ensure t
    :init
    (vertico-mode))

  ;; 2. Í≤ÄÏÉâ/ÌÉêÏÉâ Í∞ïÌôî
  (use-package consult
    :ensure t
    :bind (;; Í∏∞Ï°¥ counsel ÎåÄÏ≤¥
           ("C-s" . consult-line)          ; swiper ÎåÄÏ≤¥
           ("C-x b" . consult-buffer)      ; counsel-switch-buffer ÎåÄÏ≤¥
           ("C-x C-f" . find-file)         ; Í∑∏ÎåÄÎ°ú
           ("M-x" . execute-extended-command) ; ÎòêÎäî counsel-M-x Ïú†ÏßÄ
           ("C-c g" . consult-git-grep)
           ("C-c r" . consult-ripgrep)))
  ;; note: installment of ripgrep on the system required
  ;; ex) pacman -S ripgrep
  ;; 3. Ï†ïÎ†¨/ÌïÑÌÑ∞ÎßÅ Í∞úÏÑ†
  (use-package orderless
    :ensure t
    :custom
    (completion-styles '(orderless basic))
    (completion-category-overrides '((file (styles basic partial-completion)))))

  ;; 4. ÏûêÎèôÏôÑÏÑ± (auto-complete ÎåÄÏ≤¥)
  (use-package company
    :ensure t
    :init
    (global-company-mode)
    :config
    (setq company-idle-delay 0.2
          company-minimum-prefix-length 2))

  ;; 5. org-roam ÌÜµÌï©
  (use-package consult-org-roam
    :ensure t
    :after org-roam consult
    :config
    (consult-org-roam-mode 1)
    :custom
    (consult-org-roam-grep-func #'consult-ripgrep)
    :bind
    (("C-c n f" . consult-org-roam-file-find)      ; ÌååÏùº Ï∞æÍ∏∞
     ("C-c n b" . consult-org-roam-backlinks)      ; Î∞±ÎßÅÌÅ¨ Î≥¥Í∏∞
     ("C-c n B" . consult-org-roam-backlinks-recursive) ; Ïû¨Í∑Ä Î∞±ÎßÅÌÅ¨
     ("C-c n s" . consult-org-roam-search)         ; ÎÇ¥Ïö© Í≤ÄÏÉâ
     ("C-c n t" . consult-org-roam-forward-links))) ; Ìè¨ÏõåÎìú ÎßÅÌÅ¨
#+END_SRC

* Keyboard / Cursor / Shortcuts
** My Own Key maps
#+BEGIN_SRC emacs-lisp
  (define-prefix-command 'myjin-map)
  (global-set-key (kbd "C-c m") 'myjin-map)
#+END_SRC
** Reverting Buffer
#+BEGIN_SRC emacs-lisp
  (define-key myjin-map "r" 'myjin/revert-buffer-without-confirm)
#+END_SRC
** Shortcuts Table (mainly for file or buffer)
#+NAME: myjin/shortcuts-list
  | Keymap    | Key              | Binding Type | Link                                    | Extra Info | Note                              |
  |-----------+------------------+--------------+-----------------------------------------+------------+-----------------------------------|
  | t         | m                | file         | .code-memo.org                          | t          | nil for no prefix                 |
  | t         | b                | file         | ~/gtd/inbox.org                         | nil        |                                   |
  | t         | g                | file         | ~/gtd/gtd.org                           | nil        |                                   |
  | t         | i                | file         | myoungjin-init.org                      | t          | t for using user-emacs-directory  |
  | t         | s                | buff         | *scratch*                                 | nil        | it looks bold when type **scratch** |
  | t         | e                | file         | ~/study/english/study-english.org       | nil        |                                   |
  | t         | w                | file         | ~/gtd/writing.org                       | nil        |                                   |
  | t         | `                | func         | myjin/insert-left-quote                 | nil        | left curly quote                  |
  | t         | '                | func         | myjin/insert-right-quote                | nil        | right curl quote                  |
  |-----------+------------------+--------------+-----------------------------------------+------------+-----------------------------------|
  | t         | p                | toggle       | paredit-mode                            |            | toggle mode                       |
  | g         | C-c d            | func         | paredit-forward-down                    |            |                                   |
  | g         | C-c s            | func         | paredit-splice-sexp                     |            | for terminal compatibility        |
  | g         | C-c <left>       | func         | paredit-backward-slurp-sexp             |            | ..                                |
  | g         | C-c <right>      | func         | paredit-backward-barf-sexp              |            | ..                                |
  |-----------+------------------+--------------+-----------------------------------------+------------+-----------------------------------|
  | g         | C-]              | func         | fold-dwim-toggle                        |            |                                   |
  | g         | C-x [            | func         | fold-dwim-hide-all                      |            |                                   |
  | g         | C-x ]            | func         | fold-dwim-show-all                      |            |                                   |
  |-----------+------------------+--------------+-----------------------------------------+------------+-----------------------------------|
  | t         | j                | func         | tabbar-backward                         |            |                                   |
  | t         | k                | func         | tabbar-forward                          |            |                                   |
  | t         | h                | func         | tabbar-backward-group                   |            |                                   |
  | t         | l                | func         | tabbar-forward-group                    |            |                                   |
  |-----------+------------------+--------------+-----------------------------------------+------------+-----------------------------------|
  | g         | C-c DEL          | func         | myjin/hungry-delete-backward            |            |                                   |
  | g         | C-c <deletechar> | func         | myjin/hungry-delete-forward             |            |                                   |
  | g         | C-c a            | func         | myjin/org-agenda                        |            |                                   |
  | g         | C-c c            | func         | org-capture                             |            |                                   |
  | org-mode  | M-n              | func         | org-next-link                           |            |                                   |
  |           | C-c l            | set-key      | org-store-link                          |            |                                   |
  | org-mode  | M-p              | func         | org-previous-link                       |            |                                   |
  | org-mode  | C-c m RET        | func         | myjin/org-insert-todo-heading           |            | WORKAROUND                        |
  | org-mode  | C-c m \          | func         | org-insert-todo-heading-respect-content |            |                                   |
  | rust-mode | C-c C-c          | func         | rust-run                                |            |                                   |

#+BEGIN_SRC emacs-lisp :var shortcuts-data=myjin/shortcuts-list
  (dolist (r shortcuts-data)
    (let (key-after-map binding-type link extra-info)
      (setq key-map       (nth 0 r)
            key-after-map (nth 1 r)
            binding-type  (nth 2 r)
            link          (nth 3 r)
            extra-info    (nth 4 r))

      (cond ((or (string= key-map "") (string= key-map "g"))
             (setq key-map 'global-map))
            ((string= key-map "t")
             (setq key-map 'myjin-map))
              (t (setq key-map (intern (concat key-map "-map")))))

      (cond ((equal binding-type "file")
             (setq extra-info  (if (string= extra-info "t") t nil))
             (define-key (symbol-value key-map) (kbd key-after-map)
               `(lambda () "open a file"
                  (interactive)
                  (require 'which-key)
                  (myjin/load-file ,link ,extra-info))))

            ((equal binding-type "buff")
             (define-key (symbol-value key-map) (kbd key-after-map)
               `(lambda () "open a link"
                  (interactive) (switch-to-buffer ,link))))

            ((equal binding-type "toggle")
             (define-key (symbol-value key-map) (kbd key-after-map)
               `(lambda () "toggle major mode"
                  (interactive)
                  (let* ((s (intern ,link))
                         (on? (symbol-value s))
                         (inverse-on (if on? -1 1)))
                         (funcall s inverse-on)))))

            ((equal binding-type "set-key")
             (define-key (symbol-value key-map) (kbd key-after-map) (intern link)))


            ((equal binding-type "func")
             (define-key (symbol-value key-map) (kbd key-after-map)
               `(lambda () "call a function"
                  (interactive) (if (string= ,extra-info "") (funcall (intern ,link))
                                  (funcall (intern ,link))))))
            )))
#+END_SRC

   - see the line taged as backquote
   - REF: [[https://emacs.stackexchange.com/questions/7481/how-to-evaluate-the-variables-before-adding-them-to-a-list]]

*** HACKING make a table for shortcuts and parse them into define-key
*** TODO general key binding?? https://sam217pa.github.io/2016/09/02/how-to-build-your-own-spacemacs/
** Input Method (Korean)
#+BEGIN_SRC emacs-lisp
  (setq default-input-method "korean-hangul3f")
#+END_SRC

** Projectile
#+BEGIN_SRC emacs-lisp
  (use-package projectile
    :ensure t
    :straight t
    :bind (("C-c p f" . projectile-find-file)
           ("C-c p p" . projectile-switch-project)
           ("C-c p t" . projectile-find-test-file))
    :config
    (progn
      (setq projectile-enable-caching t)
      (add-hook 'prog-mode-hook 'projectile-mode)))
#+END_SRC

** Avy-mode
   - [[https://github.com/abo-abo/avy]]
#+BEGIN_SRC emacs-lisp
(use-package avy
  :ensure t
  :config
  (progn
    ; I use emacs in termial many times but `C-:' doesn't seem to work
    (global-set-key (kbd "M-:") 'avy-goto-char-timer)
   (setq avy-timeout-seconds 0.35)
    ; "You can actually replace the M-g g binding of goto-line,
    ; since if you enter a digit for avy-goto-line, it will switch to
    ; goto-line with that digit already entered."
    (global-set-key (kbd "M-g g") 'avy-goto-line)))
#+END_SRC

  I don't think that it is good habit to make minor mode is on globally
* Work-mode for me
:LOGBOOK:
- State "‚úî"          from              [2024-01-23 Tue 22:22] \\
  While watching a video about Clojure settings, I came across 'subword-mode.' When enabled, it allows the cursor to stop at any capital letter, similar to how it stops at white spaces, when I navigate using C-f and C-b."
  
  Link: https://www.youtube.com/watch?v=KMWLIgG986I
:END:
  so I make an mode to enable some useful stuff
  
#+BEGIN_SRC emacs-lisp
  (add-to-list 'load-path (concat user-emacs-directory
                                  (convert-standard-filename "my-lisp/")))
  (add-to-list 'load-path (concat user-emacs-directory
                                  (convert-standard-filename "our-lisp/")))

  (require 'common-allow-deny-rule) ; my-lisp
  (require 'hungry-delete)
  ;;(global-hungry-delete-mode)

  (defcustom work-mode-allowed-modes '(prog-mode emacs-lisp-mode text-mode conf-mode)
    "Major modes on which to enable the display-line-numbers mode and whitespace mode and so on"
    :group 'work-mode
    :type 'list
    :version "green")

  (defcustom work-mode-exempt-modes
    '(vterm-mode eshell-mode shell-mode term-mode ansi-term-mode)
    "Major modes on which to disable the work-mode"
    :group 'work-mode
    :type 'list
    :version "green")

  (defcustom work-mode-allowed-modes-include-derived-mode 't
    "Extends enabling work-mode through all the derived mode from work-mode-allowed mode"
    :group 'work-mode
    :type 'boolean
    :version "green")

  (defcustom work-mode-enabled-major-mode
    '(display-line-numbers-mode
      whitespace-mode
      highlight-indent-guides-mode
      paredit-mode
      subword-mode) ;; add on 23rd Jan ;; see the logbook

    "Which minor mode will be allowed when work-mode is activated"
    :group 'work-mode
    :type 'list
    :version "green")

  (defun work-mode ()
    "Turn on some usuful minor mode like display-line-numbers and whitespace"
    (let (work-mode-ready? res on-or-off derived-mode-check-function)
      (setq work-mode-ready? nil)
      (setq derived-mode-check-function
            (if work-mode-allowed-modes-include-derived-mode
                (lambda (candi given-mode) ; candi is actually not used here
                  (derived-mode-p given-mode))
              nil))

      (setq res (common-allow-deny-rule-apply major-mode
                                              work-mode-allowed-modes
                                              work-mode-exempt-modes
                                              derived-mode-check-function))
      (setq work-mode-ready? (if (equal (car res) 'allowed) t nil))
        ;;(let (status stage)
        ;;  (setq status (car res))
        ;;  (setq stage  (car (cdr res))) ;; not used
        ;;  (setq work-mode-ready? (if (eq status 'allowed) t nil)))

      ;; Do real configuration goes here
      (setq on-or-off (if work-mode-ready? 1 0))
      (dolist (mode-name work-mode-enabled-major-mode nil)
        ;;(message "%s is %s" mode-name on-or-off)
        (funcall mode-name on-or-off))))

    (add-hook 'after-change-major-mode-hook 'work-mode)
#+END_SRC

* General Programming
** Fold-dwim
#+BEGIN_SRC emacs-lisp
(use-package fold-dwim :ensure t)
;;(hideshowvis-symbols)
#+END_SRC

** Prettify-Symbols-mode
#+BEGIN_SRC emacs-lisp
  (if (myjin/display-graphic-p)
      (progn
        (add-hook
         'raku-mode-hook
         (lambda()
           (mapc (lambda (pair) (push pair prettify-symbols-alist))
                 '(("->"       . 8594)      ; ‚Üí
                   ("=>"       . 8658)      ; ‚áí
                   ("~~"       . #x2248)    ; ‚âà
                   ("eq"       . #xff1d)    ; Ôºù
                   ("le"       . #x2266)    ; ‚â¶
                   ("ge"       . #x2267)    ; ‚âß
                   ("gt"       . #xff1e)    ; Ôºû
                   ("lt"       . #xff1c)    ; Ôºú
                   ;;("==="      . #x2a76)    ; ‚©∂

                   ("return"   . #x2b6e)   ; ‚≠Æ
                   ;;("-->"      . #x27fc)   ; ‚üº
                   ("returns"  . #x27fc)   ; ‚üº

                   ("say"      . #x1f3a4)   ; üé§
                   ("print"    . #x2399)    ; ‚éô

                   ("use"      . #x271b)    ; ‚úõ
                   ("sub"      . #x2658)    ; ‚ôò;;  ("sub" . #x1d4e2) ; ùì¢
                   ("my"       . #x1d707 )  ; ùúá
                   ("our"      . #x2127 )   ; ‚Ñß
                   ("with"     . #x293a)    ; ‚§∫

                   ("Any"      . #x1f914)   ; ü§î
                   ("Int"      . #x24be)    ; ‚íæ
                   ("List"     . #x24c1)    ; ‚ìÅ
                   ("Array"    . #x24b6)    ; ‚í∂
                   ("Str"      . #x24c8)    ; ‚ìà
                   ("Bool"     . #x24b7)    ; ‚í∑

                   ("class"    . #x2656)    ; ‚ôñ
                   ("self"     . #x1f60a)   ; üòä
                   ("method"   . #x2657)    ; ‚ôó

                   ("for"      . #x2200)    ; ‚àÄ
                   ("loop"     . #x267a)    ; ‚ô∫
                   ("if"       . #x26b3)    ; ‚ö≥
                   ("elsif"    . #x1fbc4)   ; üØÑ
                   ("else"     . #x2325)    ; ‚å•
                   ("last"     . #x21f2)    ; ‚á≤
                   ("next"     . #x21f1)    ; ‚á±
                   ("proceed"  . #x2346)    ; ‚çÜ
                   ("when"     . #x2646)    ; ‚ôÜ
                   ("given"    . #x2bd5)    ; ‚Øï
                   ("default"  . #x1f3c1)   ; üèÅ

                   ("and"      . #x2227 )   ; ‚àß
                   ("or"       . #x2228 )   ; ‚à®
                   ("not"      . #x00ac )   ; ¬¨

                   ("Nil"      .  #x2205)   ; ‚àÖ
                   ("True"     . #x1d54B)   ; ùïã
                   ("False"    . #x1d53d)   ; ùîΩ
                   ;;("contains" . #x220b)    ; ‚àã

                   ("??" . #x2047) ; ‚Åá
                   ("!!" . #x203c) ; ‚Äº
                   ("||" . #x2016) ; ‚Äñ
                   )))
         ;; (add-hook
         ;;  'haskell-mode-hook
         ;;  (lambda()
         ;;    (mapc (lambda (pair) (push pair prettify-symbols-alist))
         ;;          '(("->"         . #x2192)    ; ‚Üí
         ;;            ("<-"         . #x2190)    ; ‚Üê
         ;;            ("=>"         . 8658)      ; ‚áí
         ;;            ("=="         . #x2261)    ; ‚â°
         ;;            ("/="         . #x2262)    ; ‚â¢
         ;;            (">"          . #xff1e)    ; Ôºû
         ;;            (">="         . #x2267)    ; ‚âß
         ;;            ("<"          . #xff1c)    ; Ôºú
         ;;            ("<="         . #x2266)    ; ‚â¶
         ;;            (".."         . #x2026)    ; ‚Ä¶

         ;;            ("|"          . #x23aa)    ; ‚é™
         ;;            ("&&"         . #x2227 )   ; ‚àß
         ;;            ("||"         . #x2228 )   ; ‚à®
         ;;            ("not"        . #x00ac )   ; ¬¨
         ;;            ("!!"         . #x203c )   ; ‚Äº

         ;;            ("()"         . #x2205)    ; ‚àÖ
         ;;            ("True"       . #x1d54B)   ; ùïã
         ;;            ("False"      . #x1d53d)   ; ùîΩ
         ;;            ;;("IO"         . #x21f5)    ; ‚áµ

         ;;            ("."          . #x22c5)    ; ‚ãÖ
         ;;            ("*"          . #x00d7)    ; √ó
         ;;            ("div"        . #x00f7)    ; √∑
         ;;            ("sqrt"       . #x221a)    ; ‚àö
         ;;            ("elem"       . #x2208)    ; ‚àà
         ;;            ("foldl"      . #x2945)    ; ‚•Ö
         ;;            ("foldr"      . #x2946)    ; ‚•Ü
         ;;            ("import"     . #x27fd)    ; ‚üΩ
         ;;            ("return"     . #x27fc)    ; ‚üº

         ;;            ("let"        . #x261f)   ; ‚òü
         ;;            ("in"         . #x2b78)    ; ‚§∑

         ;;            ("forall"     . #x2200)    ; ‚àÄ
         ;;            ("if"         . #x26b3)    ; ‚ö≥
         ;;            ("then"       . #x2971)    ; ‚•±
         ;;            ("else"       . #x2325)    ; ‚å•
         ;;            ("do"         . #x2907)    ; ‚§á
         ;;            ("where"      . #x261d)    ; ‚òù
         ;;            ))))
         )))

#+END_SRC

*** ‚úé check this out: https://www.modernemacs.com/post/prettify-mode/

** Highlight Indent Guides
#+BEGIN_SRC emacs-lisp
  (use-package highlight-indent-guides
    :ensure t
;    :hook ((prog-mode text-mode conf-mode) . highlight-indent-guides-mode)
    :init

    (setq highlight-indent-guides-method 'character)
    :config
    (add-hook 'focus-in-hook #'highlight-indent-guides-auto-set-faces)
    ;; `highlight-indent-guides' breaks in these modes
    (add-hook 'org-indent-mode-hook
      (defun +indent-guides-disable-maybe-h ()
        (when highlight-indent-guides-mode
          (highlight-indent-guides-mode -1)))))
#+END_SRC

* IBuffer
#+BEGIN_SRC emacs-lisp
  ;; note: if you're using screen and your escape key is "C-[Bb]",
  ;; you need to type "C-x C-b b"
  (setq ibuffer-saved-filter-groups
        (quote (("default"
                 ("Hakyll" (filename . ".*/jeongoon\\.github\\.io"))
                 ("dired" (mode . dired-mode))
                 ("org"   (name . "^.*org"))
                 ("haskell" (mode . haskell-mode))
                 ("Clojure" (or
                             (mode . clojure-mode)
                             (filename . ".*nrepl-.*$")
                             (name . "^.*Clojure.*$")))
                 ("elm"  (mode . elm-mode))
                 ("perl"  (or
                           (mode . raku-mode)
                           (mode . cperl-mode)))
                 ("programing" (or
                                 (mode . python-mode)
                                 (mode . c++-mode)
                                 (mode . shellscript-mode)
                                 (mode . fish-mode)))

                 ("emacs" (or
                           (filename . "/\\bemacs\\b*/")
                           (name . "^\\*.*\\*$"))) ))))

  (add-hook 'ibuffer-mode-hook
            (lambda ()
              (ibuffer-auto-mode 1)
              (ibuffer-switch-to-saved-filter-groups "default")))

  ;; don't show if name starts with double asterik "**blah~"
  (require 'ibuf-ext)
  (add-to-list 'ibuffer-never-show-predicates "^\\*\\*")
  ;; don't show filter groups if there are no buffers in that group
  (setq ibuffer-show-empty-filter-groups nil)

  ;; Dont ask for firmation to delete marked buffers
  (setq ibuffer-expert t)

  (setq indo-enable-flex-match t)
  (setq ido-everywhere t)
  (ido-mode 1)
  (defalias 'list-buffers 'ibuffer)
  ; or change the binding
  ;(global-set-key (kbd "C-x C-b") 'ibuffer)
#+END_SRC

* Org-mode
** Some abbreviation
#+BEGIN_SRC emacs-lisp
  (add-to-list 'org-structure-template-alist '("SE" . "src"))
#+END_SRC
** ‚úî Truncate lines for Org-mode
CLOSED: [2024-01-23 Tue 22:10]
:LOGBOOK:
- State "‚úî"          from "‚úî"          [2024-01-24 Wed 20:13] \\
  Actually there is another variable for doing this.
- State "‚úî"          from              [2024-01-23 Tue 22:10] \\
  "Actually, I thought setting 'truncate-lines' to 't' would cause long text to wrap at the frame's maximum column, but it turned out to be the opposite all the way around."
  
  TMI: "text to wrap" is right expression, I don't need to change into "to be wrapped"
:END:
#+begin_src emacs-lisp
  (setq org-startup-truncated nil)
  ;; (add-hook 'org-mode-hook
  ;;           (lambda ()
  ;;             (setq truncate-lines nil)))
#+end_src

** Todo Keywords
#+BEGIN_SRC emacs-lisp
    (setq org-todo-keywords
          '(;; For Study and default (05Mar2024)
            (sequence "‚úé(p)" "‚û§(n)" "‚ôò(y@)" "‚òï(r@)" "|" "‚úî(f@)" "‚úñ(a@)")
            ;; plan, next thing todo, on going, reviewing, finished, failed
            (sequence "TODO(o)" "|" "DONE(e)")
            ;; For General
            (sequence "TODO(t)" "LEARNING(l)" "HACKING(h@)" "WAITING(w)"
                      "|"
                      "DONE(d)" "DELEGATED(g)" "CANCELLED(c)")
            ;; For Study
            (sequence "‚úé(p)" "‚û§(n)" "‚ôò(y@)" "‚òï(r@)" "|" "‚úî(f@)" "‚úñ(a@)")))
#+END_SRC

** Todo Settings
***  https://www.youtube.com/channel/UCfbGTpcJyEOMwKP-eYz3_fg        :rainer:
 #+BEGIN_SRC emacs-lisp
 ;; https://www.youtube.com/watch?v=nUvdddKZQzs
  (setq org-log-into-drawer t)
  ;; https://www.youtube.com/watch?v=R4QSTDco_w8
  (setq org-log-done 'note)
  (setq org-log-reschedule 'note)
 #+END_SRC

*** and more ...
#+BEGIN_SRC emacs-lisp
  ;; information to record when the deadline date of a tasks is modified.
  (setq org-log-redeadline 'note)
#+END_SRC

** Archive Setting
 all the archives will be stored in the location shown below by default.
#+BEGIN_SRC emacs-lisp
(setq org-archive-location "~/archives/gtd-default-archive.org::datetree/* Finished from %s")
#+END_SRC

** Clocking                                                            :2024:
  - https://www.youtube.com/watch?v=uVv49htxuS8
#+begin_src emacs-lisp
(setq org-clock-into-draw "CLOCKING")
#+end_src

** DELEGATED GTD Method
CLOSED: [2024-01-29 Mon 18:23]
   :LOGBOOK:
   - CLOSING NOTE [2024-01-29 Mon 18:22] \\
     add more agenda files by using file-expand-wildcards
     https://emacs.stackexchange.com/questions/5560/wildcard-in-org-agenda-files
   CLOCK: [2020-05-27 Wed 00:40]--[2020-05-27 Wed 00:57] =>  0:17
   :END:
   - REF: https://emacs.cafe/emacs/orgmode/gtd/2017/06/30/orgmode-gtd.html
#+BEGIN_SRC emacs-lisp
  (setq org-agenda-files-with-wildcards
        (list "~/git/study/org-agenda-*.org"
              "~/brainstorming/*.org"
              "~/brainstorming/org-roam/*.org"))

  (defun myjin/update-org-agenda-files-list ()
    "Reload agenda file: useful when writing any new org file after init"
    (setq org-agenda-files
          (apply #'append
                 (cons (list (myjin/expand-file-name "myoungjin-init.org" t)
                             "~/gtd/inbox.org"
                             "~/gtd/gtd.org"
                             "~/gtd/tickler.org")
                  ;; 29 Jan 2024
                  ;; Any org-mode file that begins with 'org-agenda-'
                  ;; in the study is recognized as an agenda file
                       (mapcar #'file-expand-wildcards org-agenda-files-with-wildcards)))))

  ;; for initializing
  (myjin/update-org-agenda-files-list)

  (setq org-capture-templates '(("t" "Todo [inbox]" entry
                                 (file+headline "~/gtd/inbox.org" "Tasks")
                                 "* TODO %i%?")
                                ("T" "Tickler" entry
                                 (file+headline "~/gtd/tickler.org" "Tickler")
                                 "* %i%? \n %U")))


  (setq org-refile-allow-creating-parent-nodes (quote confirm))
  (setq org-refile-use-outline-path (quote file))
  (setq org-refile-targets '(("~/gtd/gtd.org"      :maxlevel . 2)
                             ("~/gtd/someday.org"  :level    . 1)
                             ("~/gtd/tickler.org"  :maxlevel . 2)
                             ;; or simply same level
                             ;; (org-agenda-files  :level . 1 )
                             ;; nil for current file
                             ;; put line bellow at last so that it shows
                             ;; at the bottom when searching
                             (nil :maxlevel . 9)))

  ;; copied from https://www.reddit.com/r/emacs/comments/4366f9/how_do_orgrefiletargets_work/
  ;; I'm using ivy but still useful to search the tree to where I refile
  (setq org-outline-path-complete-in-steps nil) ; Refile in a single go
  (setq org-refile-use-outline-path t)    ; Show full paths for refiling

  (setq org-refile-allow-creating-parent-nodes 'confirm)

  (setq org-agenda-custom-commands
        '(("h" "at MJ home" tags-todo "@home"
          ;; ((org-agenda-overriding-header "home")))))
          ((org-agenda-overriding-header "home")
           (org-agenda-skip-function #'our/org-aenda-skip-all-siblings-but-first)))))

  ;; CREDIT: https://emacs.cafe/emacs/orgmode/gtd/2017/06/30/orgmode-gtd.html
  (defun our/is-current-org-todo? ()
    (string= "TODO" (org-get-todo-state)))

  (defun our/org-aenda-skip-all-siblings-but-first ()
    "Skip all but the first undone entry"
    (let (skip-entry?)
      (unless (our/is-current-org-todo?)
        (setq skip-entry? t))

      (save-excursion
        (while (and (not skip-entry?) (org-goto-sibling t))
          (when (our/is-current-org-todo?)
            (setq skip-entry? t))))
      (when skip-entry?
        (or (outline-next-heading)
            (goto-char (point-max))))))

#+END_SRC

#+RESULTS:
: our/org-aenda-skip-all-siblings-but-first

** Org bullet mode
#+BEGIN_SRC emacs-lisp
  (use-package org-bullets :ensure t
    :config
    (add-hook 'org-mode-hook (lambda () (org-bullets-mode 1))))

  (setq org-hide-emphasis-markers t)

  (defvar myjin/org-bullets-bullet-list-common
    '("‚ùÇ" "‚äõ" "‚ú™" "‚úµ" "‚úº"  "‚úß" "‚Åï" )
    "rxvt-unicode can display those chars with nerd font; It is actually can be drawed with GNU FreeSerif also")

  (defvar myjin/org-bullets-bullet-list)
  (defvar myjin/org-ellipsis " ¬ª")
  (setq myjin/org-bullets-bullet-list (cons (if (myjin/display-graphic-p) "‚öù" "‚ùÉ")
                                                myjin/org-bullets-bullet-list-common))

  (setq org-bullets-bullet-list myjin/org-bullets-bullet-list)
  (setq org-ellipsis (if (myjin/display-graphic-p) "‚ÆØ"  " ¬ª"))

  (font-lock-add-keywords 'org-mode
                          '(("^ +\\([-*]\\) "
                             (0 (prog1 () (compose-region (match-beginning 1) (match-end 1) "‚Ä¢"))))))

#+END_SRC

#+RESULTS:

**** DONE make some vertical align to use Segoe UI Emoji Font: replaced with Symbola
     CLOSED: [2020-12-24 Thu 14:46]
     :LOGBOOK:
     - CLOSING NOTE [2020-12-24 Thu 14:46]
     :END:
*** HACKING TESTING

**
#+BEGIN_SRC emacs-lisp
  (setq org-link-frame-setup
        (quote
         ((vm . vm-visit-folder-other-frame)
          (vm-imap . vm-visit-imap-folder-other-frame)
          (gnus . org-gnus-no-new-news)
          (file . find-file)
          (wl . wl-other-frame))))

  ;; From http://www.howardism.org/Technical/Emacs/orgmode-wordprocessor.html
  (when (window-system)
    (let* ((variable-tuple (cond ((x-list-fonts "Source Sans Pro") '(:font "Source Sans Pro"))
                                 ((x-list-fonts "Lucida Grande")   '(:font "Lucida Grande"))
                                 ((x-family-fonts "Fira Sans Compressed")   '(:family "Fira Sans Compressed"))
                                 ((x-list-fonts "FantasqueSansMono Nerd Font Mono")   '(:font "FantasqueSansMono Nerd Font Mono"))
                                 ((x-list-fonts "Verdana")         '(:font "Verdana"))
                                 ((x-family-fonts "Sans Serif")    '(:family "Sans Serif"))
                                 (nil (warn "Cannot find a Sans Serif Font.  Install Source Sans Pro."))))
           (base-font-color     (face-foreground 'default nil 'default))
           (headline           `(:inherit default :weight bold :foreground ,base-font-color)))

      (custom-theme-set-faces 'user
                              `(org-level-8 ((t (,@headline ,@variable-tuple))))
                              `(org-level-7 ((t (,@headline ,@variable-tuple))))
                              `(org-level-6 ((t (,@headline ,@variable-tuple))))
                              `(org-level-5 ((t (,@headline ,@variable-tuple))))
                              `(org-level-4 ((t (,@headline ,@variable-tuple :height 1.1))))
                              `(org-level-3 ((t (,@headline ,@variable-tuple :height 1.25))))
                              `(org-level-2 ((t (,@headline ,@variable-tuple :height 1.5))))
                              `(org-level-1 ((t (,@headline ,@variable-tuple :height 1.5))))
                              `(org-document-title ((t (,@headline ,@variable-tuple :height 1.5 :underline nil))))))
    )

#+END_SRC

* Org-mode Check Level 1 (Type C-c C-k)
** Check Level 2
*** Check Level 3
**** Check Level 4
***** Check Level 5
****** check level 6
******* check level 7
******** check level 8

* Org-Roam
#+begin_src emacs-lisp
  (use-package org-roam
    :ensure t
    :custom
    (org-roam-directory "~/brainstorming/org-roam")
    :bind (("C-c n l" . org-roam-buffer-toggle)
           ("C-c n f" . org-roam-node-find)
           ("C-c n i" . org-roam-node-insert))
    :config
    (org-roam-setup)
    )
#+end_src

* Dired / Listing / Bookmarks
** Open Bookmark by Default
#+BEGIN_SRC emacs-lisp
;;; open bookmark when emacs is running withougt visiting a file.
;;  note: it is not working when emacs is running as daemon
(defun make-initial-buffer-as-bookmark-if-no-file-visited ()
  (let ((no-file-visited t)
        (args command-line-args))
    (dolist (arg (cdr args))
      (progn
        (if (file-exists-p arg)
            (setq no-file-visited nil))))
    (when no-file-visited
      (bookmark-bmenu-list) ;; create a book mark buffer first
      (setq initial-buffer-choice (lambda ()(get-buffer "*Bookmark List*"))))))

(add-hook 'after-init-hook
          (lambda () (make-initial-buffer-as-bookmark-if-no-file-visited)))
#+END_SRC

** All-the-icons-Dired vs treemacs-icons-dired
#+BEGIN_SRC emacs-lisp
  (use-package all-the-icons-dired :ensure t
    :config
    (add-hook 'dired-mode-hook #'all-the-icons-dired-mode))
#+END_SRC

** TODO Treemacs
#+BEGIN_SRC emacs-lisp
    (use-package treemacs
      :ensure t
      :defer t
      :init
      (with-eval-after-load 'winum
        (define-key winum-keymap (kbd "M-0") #'treemacs-select-window))
      :config
      (progn
        (setq treemacs-collapse-dirs                 (if treemacs-python-executable 3 0)
              treemacs-deferred-git-apply-delay      0.5
              treemacs-directory-name-transformer    #'identity
              treemacs-display-in-side-window        t
              treemacs-eldoc-display                 t
              treemacs-file-event-delay              5000
              treemacs-file-extension-regex          treemacs-last-period-regex-value
              treemacs-file-follow-delay             0.2
              treemacs-file-name-transformer         #'identity
              treemacs-follow-after-init             t
              treemacs-git-command-pipe              ""
              treemacs-goto-tag-strategy             'refetch-index
              treemacs-indentation                   2
              treemacs-indentation-string            " "
              treemacs-is-never-other-window         nil
              treemacs-max-git-entries               5000
              treemacs-missing-project-action        'ask
              treemacs-move-forward-on-expand        nil
              treemacs-no-png-images                 nil
              treemacs-no-delete-other-windows       t
              treemacs-project-follow-cleanup        nil
              treemacs-persist-file                  (expand-file-name ".cache/treemacs-persist" user-emacs-directory)
              treemacs-position                      'left

              treemacs-recenter-distance             0.1
              treemacs-recenter-after-file-follow    nil
              treemacs-recenter-after-tag-follow     nil
              treemacs-recenter-after-project-jump   'always
              treemacs-recenter-after-project-expand 'on-distance
              treemacs-run-in-every-buffer           t
              treemacs-show-cursor                   nil
              treemacs-show-hidden-files             t
              treemacs-silent-filewatch              nil
              treemacs-silent-refresh                nil
              treemacs-sorting                       'alphabetic-asc
              treemacs-space-between-root-nodes      t
              treemacs-tag-follow-cleanup            t
              treemacs-tag-follow-delay              1.5
              treemacs-user-mode-line-format         nil
              treemacs-user-header-line-format       nil
              treemacs-width                         35)

        ;; The default width and height of the icons is 22 pixels. If you are
        ;; using a Hi-DPI display, uncomment this to double the icon size.
        (treemacs-resize-icons 18)

        (treemacs-follow-mode t)
        (treemacs-filewatch-mode t)
        (treemacs-fringe-indicator-mode t)
        (pcase (cons (not (null (executable-find "git")))
                     (not (null treemacs-python-executable)))
          (`(t . t)
           (treemacs-git-mode 'deferred))
          (`(t . _)
           (treemacs-git-mode 'simple))))
      :bind
      (:map global-map
            ("M-0"       . treemacs-select-window)
            ("C-x t 1"   . treemacs-delete-other-windows)
            ("C-x t t"   . treemacs)
            ("C-x t B"   . treemacs-bookmark)
            ("C-x t C-t" . treemacs-find-file)
            ("C-x t M-t" . treemacs-find-tag)))

  ;  (use-package treemacs-evil
  ;    :after treemacs evil
  ;    :ensure t)

    (use-package treemacs-projectile
      :after treemacs projectile
      :ensure t)

    (use-package treemacs-magit
      :after treemacs magit
      :ensure t)

    (use-package treemacs-persp
      :after treemacs persp-mode
      :ensure t
      :config (treemacs-set-scope-type 'Perspectives))
#+END_SRC

* Docker
 #+BEGIN_SRC emacs-lisp
   (use-package dockerfile-mode :ensure t)
#+END_SRC

* Misc / Testing
** Beacon
#+BEGIN_SRC emacs-lisp
    (unless (myjin/display-graphic-p) ;; it is buggy with my X-window setup
        (use-package beacon :ensure t
          :config
          (progn
          (beacon-mode 1)
          (setq beacon-blink-when-buffer-changes t)
          (setq beacon-blink-when-focused t))))
#+END_SRC
** Neo-tree
#+BEGIN_SRC emacs-lisp
;;(use-package neotree
;;  :ensure t
;;  :config (progn
;;            (setq neo-smart-open t)
;;            (setq neo-window-fixed-size nil)
;;            (global-set-key [f8] 'neotree-toggle)))
;;    (evil-leader/set-key
;;     "tt" 'neotree-toggle
;;           "tp" 'neotree-projectile-action)))
#+END_SRC
** Nov-mode
#+BEGIN_SRC emacs-lisp
  (use-package nov
    :ensure t
    :init
    (defun my-nov-font-setup ()
      (face-remap-add-relative
      'variable-pitch '(:family "Bookerly" :height 1.3)))
    :config
    (progn
      (setq nov-text-width t)
      (setq visual-fill-column-center-text t)
      (add-hook 'nov-mode-hook (lambda () (visual-line-mode)))
      (if (myjin/display-graphic-p)
          (add-hook 'nov-mode-hook 'my-nov-font-setup))
      (add-to-list 'auto-mode-alist '("\\.epub\$" . nov-mode))))
#+END_SRC
** Image size
#+BEGIN_SRC emacs-lisp
  (setq max-image-size "no limit??")
#+END_SRC
** Visual-line-mode
   - this is from [[https://www.emacswiki.org/emacs/VisualLineMode]]
#+BEGIN_SRC emacs-lisp
  (defvar visual-wrap-column nil)

  (defun set-visual-wrap-column (new-wrap-column &optional buffer)
    "Force visual line wrap at NEW-WRAP-COLUMN in BUFFER (defaults
  to current buffer) by setting the right-hand margin on every
  window that displays BUFFER.  A value of NIL or 0 for
  NEW-WRAP-COLUMN disables this behavior."
    (interactive (list (read-number "New visual wrap column, 0 to disable: " (or visual-wrap-column fill-column 0))))
    (if (and (numberp new-wrap-column)
             (zerop new-wrap-column))
      (setq new-wrap-column nil))
    (with-current-buffer (or buffer (current-buffer))
      (visual-line-mode t)
      (set (make-local-variable 'visual-wrap-column) new-wrap-column)
      (add-hook 'window-configuration-change-hook 'update-visual-wrap-column nil t)
      (let ((windows (get-buffer-window-list)))
        (while windows
          (when (window-live-p (car windows))
            (with-selected-window (car windows)
              (update-visual-wrap-column)))
          (setq windows (cdr windows))))))

  (defun update-visual-wrap-column ()
    (if (not visual-wrap-column)
      (set-window-margins nil nil)
      (let* ((current-margins (window-margins))
             (right-margin (or (cdr current-margins) 0))
             (current-width (window-width))
             (current-available (+ current-width right-margin)))
        (if (<= current-available visual-wrap-column)
          (set-window-margins nil (car current-margins))
          (set-window-margins nil (car current-margins)
                              (- current-available visual-wrap-column))))))
#+END_SRC


* Hair Studio Image Upload
#+BEGIN_SRC emacs-lisp
  ;;(unless (boundp 'business-photo-auto-convert)
  ;;  (setq business-photo-auto-convert nil))
    (use-package business-photo-upload
      ;;:load-path "~/.emacs.d/my-lisp/"
      :init
      ;;(setq business-photo-auto-convert nil)
      :custom
      ;; === ÌååÏùº ÏúÑÏπò ÏÑ§Ï†ï ===
      (business-photo-org-directory "~/gtd/")     ; org ÎîîÎ†âÌÜ†Î¶¨
      (business-photo-log-filename "hair-studio-celine-media-upload.org")       ; ÌååÏùºÎ™Ö
      ;; === Capture ÏÑ§Ï†ï ===
      (business-photo-capture-key "B")                    ; Capture ÌÇ§ (BÍ∞Ä Ï∂©ÎèåÏãú)
      (business-photo-auto-convert t)                     ; ÏûêÎèô Î≥ÄÌôò Ïó¨Î∂Ä
      ;; === Ïù¥ÎØ∏ÏßÄ Î≥ÄÌôò ÏÑ§Ï†ï ===
      ;;(business-photo-apple-max-size 3000)               ; Apple ÏµúÎåÄ ÌÅ¨Í∏∞ (ÌîΩÏÖÄ)
      (business-photo-apple-quality 100)                  ; Apple JPEG ÌíàÏßà (1-100)
      (business-photo-google-quality 100)                 ; Google JPEG ÌíàÏßà (1-100)
      (business-photo-show-images nil)        ; ÏûêÎèô Ïù¥ÎØ∏ÏßÄ ÌëúÏãú
      (business-photo-image-width 250)      ; ÌëúÏãú ÌÅ¨Í∏∞ (ÌîΩ)ÏÖÄ
      (business-photo-search-directories
       '("~/Pictures/iCloud/"))
      ;;:bind
      ;; Ï†ÑÏó≠ ÌÇ§Î∞îÏù∏Îî©
      ;;(("C-c p u" . my/business-mark-uploaded)           ; ÏóÖÎ°úÎìú Ï≤¥ÌÅ¨
      ;;("C-c p d" . my/business-convert-directory))      ; ÎîîÎ†âÌÜ†Î¶¨ Î≥ÄÌôò
      ;;:hook
      ;; org-modeÏóêÏÑúÎßå ÌôúÏÑ±ÌôîÎêòÎäî ÌÇ§Î∞îÏù∏Îî©
      ;;(org-mode . (lambda ()
      ;; (local-set-key (kbd "C-c b m") 'my/business-mark-uploaded)
      ;;(local-set-key (kbd "C-c b d") 'my/business-convert-directory)))
      :config
      ;; Ìå®ÌÇ§ÏßÄ Î°úÎìú ÌõÑ Ïã§Ìñâ
      (message "Business photo upload loaded with directory: %s" 
               business-photo-org-directory))
#+END_SRC

* Experiment
  - hide some minor mode
  [[https://emacs.stackexchange.com/questions/3925/hide-list-of-minor-modes-in-mode-line/3928#comment5928_3928]]
#+BEGIN_SRC emacs-lisp
(defvar hidden-minor-modes ; example, write your own list of hidden
  '(abbrev-mode            ; minor modes
    auto-fill-function
    auto-complete-mode
;    flycheck-mode
;    flyspell-mode
;    inf-haskell-mode
;    haskell-indent-mode
;    haskell-doc-mode
    smooth-scroll-mode))

(defun purge-minor-modes ()
  (interactive)
  (dolist (x hidden-minor-modes nil)
    (let ((trg (cdr (assoc x minor-mode-alist))))
      (when trg
        (setcar trg "")))))

(add-hook 'after-change-major-mode-hook 'purge-minor-modes)

#+END_SRC

* Spell check

#+begin_src emacs-lisp
  (use-package ispell
    :custom
    (ispell-program-name "hunspell")
    (ispell-dictionary "ko_KR")
    (ispell-local-dictionary-alist
     '(("ko_KR" "[Í∞Ä-Ìû£]" "[^Í∞Ä-Ìû£]" "[']" nil ("-d" "ko_KR") nil utf-8))))

  ;; flyspell ÏÑ§Ï†ï
  (use-package flyspell
    :hook
    (text-mode . flyspell-mode)
    (prog-mode . flyspell-prog-mode)
    :bind
    (:map flyspell-mode-map
          ;; Í∏∞Î≥∏ ÌÇ§Î∞îÏù∏Îî©Ïù¥ Îã§Î•∏ Î©îÏù¥Ï†Ä Î™®ÎìúÏôÄ Ï∂©ÎèåÌï† Ïàò ÏûàÏñ¥ÏÑú Ï†úÍ±∞
          ("C-;" . nil)
          ("C-." . nil)
          ("C-," . nil))
    :custom
    (flyspell-issue-message-flag nil)  ; ÏÑ±Îä• Ìñ•ÏÉÅÏùÑ ÏúÑÌï¥ Î©îÏãúÏßÄ Ï∂úÎ†• ÎπÑÌôúÏÑ±Ìôî
    (flyspell-issue-welcome-flag nil))
#+end_src

#+begin_src elisp
  ;; ÌåùÏóÖ Ïù∏ÌÑ∞ÌéòÏù¥Ïä§ Í∞úÏÑ†ÏùÑ ÏúÑÌïú popup Ìå®ÌÇ§ÏßÄ ÏÑ§Ï†ï
  (use-package popup
    :ensure t)

  ;; flyspell-popup ÏÑ§Ï†ï (ÎßàÏö∞Ïä§ Ïö∞ÌÅ¥Î¶≠ ÎåÄÏã† ÌåùÏóÖ Ïù∏ÌÑ∞ÌéòÏù¥Ïä§ ÏÇ¨Ïö©)
  (use-package flyspell-popup
    :ensure t
    :after flyspell
    :bind (:map flyspell-mode-map
           ("C-;" . flyspell-popup-correct))
    :hook
    (flyspell-mode . flyspell-popup-auto-correct-mode))
#+end_src

* Timer
 - <2025-09-03 Wed> added
#+begin_src emacs-lisp
(defun myjin/org-timer-notification (title message)
  "Send system notification on Linux"
  (start-process "notify-send" nil
                 "notify-send"
                 "-t" "5000"  ; 5Ï¥àÍ∞Ñ ÌëúÏãú
                 title message))

(add-hook 'org-timer-done-hook
          (lambda ()
            (myjin/org-timer-notification
             "Org Timer"
             "Timer completed!")))
#+end_src

* Bill payment helper
 - <2025-09-03 Wed> added

#+begin_src emacs-lisp
  ;; deadline Ïù¥Ï†ÑÏùò ÏàòÏöîÏùºÏùÑ Ï∞æÎäî Ìï®Ïàò
  (defun myjin/wednesday-before-deadline (date-string)
    "Given a deadline date string, return the last Wednesday before or on that date."
    (let* ((parsed-date (org-parse-time-string date-string))
           (year (nth 5 parsed-date))
           (month (nth 4 parsed-date))
           (day (nth 3 parsed-date))
           ;; encode-timeÏùÑ ÏÇ¨Ïö©Ìï¥ÏÑú Ï£ºÏñ¥ÏßÑ ÎÇ†ÏßúÎ•º timeÏúºÎ°ú Î≥ÄÌôò
           (deadline-time (encode-time 0 0 0 day month year))
           (deadline-decoded (decode-time deadline-time))
           (day-of-week (nth 6 deadline-decoded)) ; 0=ÏùºÏöîÏùº, 1=ÏõîÏöîÏùº, ..., 3=ÏàòÏöîÏùº
           ;; ÏàòÏöîÏùºÍπåÏßÄ Îí§Î°ú Í∞ÄÏïº Ìï† ÏùºÏàò Í≥ÑÏÇ∞
           (days-back (if (<= day-of-week 3)
                          ;; Ïùº~ÏàòÏöîÏùºÏù∏ Í≤ΩÏö∞: Ïù¥Ï†Ñ Ï£º ÏàòÏöîÏùºÎ°ú
                          (+ (- day-of-week 3) 7)
                          ;; Î™©~ÌÜ†ÏöîÏùºÏù∏ Í≤ΩÏö∞: Ïù¥Î≤à Ï£º ÏàòÏöîÏùºÎ°ú
                          (- day-of-week 3)))
           ;; ÎÇ†Ïßú Í≥ÑÏÇ∞ (Ïõî Í≤ΩÍ≥Ñ ÏûêÎèô Ï≤òÎ¶¨)
           (wednesday-time (time-subtract deadline-time (days-to-time days-back))))
      (format-time-string "%Y-%m-%d %a" wednesday-time)))

  ;; Ìôà Ï†ÑÍ∏∞ÏÑ∏ ÌÖúÌîåÎ¶ø ÏÉùÏÑ± Ìï®Ïàò (schedule Ìè¨Ìï®)
  (defun myjin/home-electricity-template ()
    "Generate home electricity bill template with schedule."
    (let* ((due-date (read-string "Due Date (YYYY-MM-DD): "))
           (amount (read-string "Amount: "))
           (recurrence (read-string "Recurrence (e.g., ++1m, ++3m, or empty): "))
           (payment-date (myjin/wednesday-before-deadline due-date))
           (schedule-string (if (string-empty-p recurrence)
                               payment-date
                             (format "%s %s" payment-date recurrence))))
      (format " - %s by %s\n   SCHEDULED: <%s>" amount due-date schedule-string)))

  ;; Ìôà Í∞ÄÏä§ÎπÑ ÌÖúÌîåÎ¶ø ÏÉùÏÑ± Ìï®Ïàò (schedule Ìè¨Ìï®)
  (defun myjin/home-gas-template ()
    "Generate home gas bill template with schedule."
    (let* ((due-date (read-string "Due Date (YYYY-MM-DD): "))
           (amount (read-string "Amount: "))
           (recurrence (read-string "Recurrence (e.g., ++1m, ++3m, or empty): "))
           (payment-date (myjin/wednesday-before-deadline due-date))
           (schedule-string (if (string-empty-p recurrence)
                               payment-date
                             (format "%s %s" payment-date recurrence))))
      (format " - %s by %s\n   SCHEDULED: <%s>" amount due-date schedule-string)))

  ;; ÎπÑÏ¶àÎãàÏä§ Ï†ÑÍ∏∞ÏÑ∏ ÌÖúÌîåÎ¶ø ÏÉùÏÑ± Ìï®Ïàò (schedule Ìè¨Ìï®)
  (defun myjin/business-electricity-template ()
    "Generate business electricity bill template with schedule."
    (let* ((due-date (read-string "Due Date (YYYY-MM-DD): "))
           (amount (read-string "Amount: "))
           (recurrence (read-string "Recurrence (e.g., ++1m, ++3m, or empty): "))
           (payment-date (myjin/wednesday-before-deadline due-date))
           (schedule-string (if (string-empty-p recurrence)
                               payment-date
                             (format "%s %s" payment-date recurrence))))
      (format " - %s by %s\n   SCHEDULED: <%s>" amount due-date schedule-string)))

  ;; L'oreal ÌÖúÌîåÎ¶ø ÏÉùÏÑ± Ìï®Ïàò (6Í∞úÏõî Î∞òÎ≥µ)
  (defun myjin/loreal-template ()
    "Generate L'oreal payment template with 6-month recurring schedule."
    (let* ((due-date (read-string "Due Date (YYYY-MM-DD): "))
           (amount (read-string "Amount: "))
           (description (read-string "Description (optional): "))
           (payment-date (myjin/wednesday-before-deadline due-date))
           (schedule-string (format "%s ++6m" payment-date))
           (desc-text (if (string-empty-p description) "" (format " - %s" description))))
      (format " - %s by %s%s\n   SCHEDULED: <%s>" amount due-date desc-text schedule-string)))

  ;; ÏÉàÎ°úÏö¥ Ï≤≠Íµ¨ÏÑú Ìï≠Î™© ÏÉùÏÑ± Ìï®Ïàò (ÌïÑÏöîÏãú)
  (defun myjin/bill-template-generator ()
    "Generate a bill template with calculated Wednesday payment date and schedule."
    (let* ((bill-name (read-string "Bill Name: "))
           (due-date (read-string "Due Date (YYYY-MM-DD): "))
           (account (read-string "Account: "))
           (amount (read-string "Amount: "))
           (recurrence (read-string "Recurrence (e.g., ++1m, ++3m, or empty): "))
           (payment-date (myjin/wednesday-before-deadline due-date))
           (schedule-string (if (string-empty-p recurrence)
                               payment-date
                             (format "%s %s" payment-date recurrence))))
      (format "*** TODO %s\nSCHEDULED: <%s>\n:PROPERTIES:\n:ACCOUNT: %s\n:END:\n - %s by %s"
              bill-name schedule-string account amount due-date)))

  ;; ÏÉàÎ°úÏö¥ L'oreal TODO Ìï≠Î™© ÏÉùÏÑ± Ìï®Ïàò
  (defun myjin/loreal-todo-template ()
    "Generate new L'oreal TODO entry with 6-month recurring schedule."
    (let* ((due-date (read-string "Due Date (YYYY-MM-DD): "))
           (amount (read-string "Amount: "))
           (description (read-string "Description: "))
           (payment-date (myjin/wednesday-before-deadline due-date))
           (schedule-string (format "%s ++6m" payment-date)))
      (format "*** TODO Pay L'oreal - %s\nSCHEDULED: <%s>\n:PROPERTIES:\n:ACCOUNT: %s\n:END:\n - %s by %s"
              description schedule-string 
              (read-string "Account: ") amount due-date)))

  ;; Bill Í¥ÄÎ†® capture ÌÖúÌîåÎ¶øÎì§ÏùÑ Í∏∞Ï°¥ ÌÖúÌîåÎ¶øÏóê Ï∂îÍ∞ÄÌïòÎäî Ìï®Ïàò
  (defun myjin/add-bill-capture-templates ()
    "Add bill-related capture templates to existing org-capture-templates"
    (let ((bill-templates
           '(("b" "Bills")
             ("bh" "Home Bills")          ; bhe, bhg, bhnÏùÑ ÏúÑÌïú Í∑∏Î£π Ìó§Îçî
             ("bhe" "Home Electricity Bill" item
              (file+olp "~/gtd/gtd.org" "TODO Payment and Bills" "TODO Bills" "TODO Pay Electricty for Home")
              (function myjin/home-electricity-template)
              :immediate-finish t)
             
             ("bhg" "Home Gas Bill" item
              (file+olp "~/gtd/gtd.org" "TODO Payment and Bills" "TODO Bills" "TODO Pay Gas for Home")
              (function myjin/home-gas-template)
              :immediate-finish t)
              
             ("bhn" "New Home Bill" entry
              (file+olp "~/gtd/gtd.org" "TODO Payment and Bills" "TODO Bills")
              "*** TODO %^{Bill Name} :HOME:\nSCHEDULED: <%^{Due Date}>\n:PROPERTIES:\n:ACCOUNT: COM: 72688117\n:END:\n - %^{Amount} by %^{Due Date}")
              
             ("bb" "Business Bills")       ; bbe, bbnÏùÑ ÏúÑÌïú Í∑∏Î£π Ìó§Îçî
             ("bbe" "Business Electricity Bill" item
              (file+olp "~/gtd/gtd.org" "TODO Payment and Bills" "TODO Bills" "TODO Pay Electricty for Shop")
              (function myjin/business-electricity-template)
              :immediate-finish t)
              
             ("bbn" "New Business Bill" entry
              (file+olp "~/gtd/gtd.org" "TODO Payment and Bills" "TODO Bills")
              "*** TODO %^{Bill Name} :SHOP:\nSCHEDULED: <%^{Due Date}>\n:PROPERTIES:\n:ACCOUNT: Westpac\n:END:\n - %^{Amount} by %^{Due Date}")
              
             ;; L'oreal Í¥ÄÎ†®
             ("bl" "L'oreal")              ; bl, blnÏùÑ ÏúÑÌïú Í∑∏Î£π Ìó§Îçî  
             ("blp" "L'oreal Payment" item  ; Í≥µÎ∞± Ï∂îÍ∞ÄÎ°ú Íµ¨Î∂Ñ
              (file+olp "~/gtd/gtd.org" "TODO Payment and Bills" "TODO Bills" "TODO Pay L'oreal")
              (function myjin/loreal-template)
              :immediate-finish t)
              
             ("bln" "New L'oreal TODO" entry
              (file+olp "~/gtd/gtd.org" "TODO Payment and Bills" "TODO Bills")
              (function myjin/loreal-todo-template)
              :immediate-finish t)
              
             ;; ÏÉàÎ°úÏö¥ Ï≤≠Íµ¨ÏÑú Ìï≠Î™© ÏÉùÏÑ±
             ("bn" "New Bills")            ; bnwÎ•º ÏúÑÌïú Í∑∏Î£π Ìó§Îçî
             ("bnw" "New Bill with Schedule" entry
              (file+olp "~/gtd/gtd.org" "TODO Payment and Bills" "TODO Bills")
              (function myjin/bill-template-generator)
              :immediate-finish t))))
      
      ;; Í∏∞Ï°¥ org-capture-templatesÍ∞Ä ÏóÜÏúºÎ©¥ Ï¥àÍ∏∞Ìôî
      (unless (boundp 'org-capture-templates)
        (setq org-capture-templates '()))
      
      ;; Í∏∞Ï°¥ ÌÖúÌîåÎ¶øÏóê Ï∂îÍ∞Ä
      (setq org-capture-templates
            (append org-capture-templates bill-templates))))

  ;; org-capture Î°úÎìú ÌõÑ ÌÖúÌîåÎ¶ø Ï∂îÍ∞Ä
  (with-eval-after-load 'org-capture
    (myjin/add-bill-capture-templates))
           
  ;; Capture Îã®Ï∂ïÌÇ§ ÏÑ§Ï†ï (ÏÑ†ÌÉùÏÇ¨Ìï≠)
  ;;(global-set-key (kbd "C-c c") 'org-capture)

  ;; Îçî Îπ†Î•∏ Ï†ëÍ∑ºÏùÑ ÏúÑÌïú Í∞úÎ≥Ñ Îã®Ï∂ïÌÇ§ ÏÑ§Ï†ï (ÏÑ†ÌÉùÏÇ¨Ìï≠)
  ;;(global-set-key (kbd "C-c b h e") (lambda () (interactive) (org-capture nil "bhe")))
  ;;(global-set-key (kbd "C-c b h g") (lambda () (interactive) (org-capture nil "bhg")))
  ;;(global-set-key (kbd "C-c b b e") (lambda () (interactive) (org-capture nil "bbe")))
#+end_src


